<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>ГЛАВА 8 Выявление структурных изменений | Анализ временных рядов с помощью R</title>
  <meta name="description" content="Современные методы анализа временных рядов, реализованные в системе статистических вычислений R" />
  <meta name="generator" content="bookdown 0.18 and GitBook 2.6.7" />

  <meta property="og:title" content="ГЛАВА 8 Выявление структурных изменений | Анализ временных рядов с помощью R" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://ranalytics.github.io/tsa-with-r" />
  <meta property="og:image" content="https://ranalytics.github.io/tsa-with-rfigures/tsa_with_r_cover_cropped.png" />
  <meta property="og:description" content="Современные методы анализа временных рядов, реализованные в системе статистических вычислений R" />
  <meta name="github-repo" content="ranalytics/tsa-r" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="ГЛАВА 8 Выявление структурных изменений | Анализ временных рядов с помощью R" />
  
  <meta name="twitter:description" content="Современные методы анализа временных рядов, реализованные в системе статистических вычислений R" />
  <meta name="twitter:image" content="https://ranalytics.github.io/tsa-with-rfigures/tsa_with_r_cover_cropped.png" />

<meta name="author" content="Мастицкий С. Э." />


<meta name="date" content="2020-04-11" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="ch-intro-to-bsts.html"/>
<link rel="next" href="ch-anomaly-detection.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Анализ временных рядов с помощью R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Аннотация</a></li>
<li class="chapter" data-level="" data-path="thanks.html"><a href="thanks.html"><i class="fa fa-check"></i>Благодарности</a></li>
<li class="chapter" data-level="" data-path="other-formats.html"><a href="other-formats.html"><i class="fa fa-check"></i>Дополнительные форматы книги</a></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Введение</a><ul>
<li class="chapter" data-level="1.1" data-path="intro.html"><a href="intro.html#what-this-book-is-about"><i class="fa fa-check"></i><b>1.1</b> О чем эта книга и чего в ней нет</a></li>
<li class="chapter" data-level="1.2" data-path="intro.html"><a href="intro.html#who-this-book-is-for"><i class="fa fa-check"></i><b>1.2</b> Что ожидается от читателя</a></li>
<li class="chapter" data-level="1.3" data-path="intro.html"><a href="intro.html#sec-main-concepts"><i class="fa fa-check"></i><b>1.3</b> Основные понятия</a></li>
<li class="chapter" data-level="1.4" data-path="intro.html"><a href="intro.html#sec-data-format"><i class="fa fa-check"></i><b>1.4</b> Формат данных <code>tsibble</code></a></li>
<li class="chapter" data-level="1.5" data-path="intro.html"><a href="intro.html#sec-example-datasets"><i class="fa fa-check"></i><b>1.5</b> Данные, используемые в примерах</a><ul>
<li class="chapter" data-level="1.5.1" data-path="intro.html"><a href="intro.html#subsec-cryptos-price"><i class="fa fa-check"></i><b>1.5.1</b> Стоимость 22 криптовалют</a></li>
<li class="chapter" data-level="1.5.2" data-path="intro.html"><a href="intro.html#subsec-bitcoin-price"><i class="fa fa-check"></i><b>1.5.2</b> Стоимость биткоина</a></li>
<li class="chapter" data-level="1.5.3" data-path="intro.html"><a href="intro.html#subsec-share-price"><i class="fa fa-check"></i><b>1.5.3</b> Цена акций трех компаний</a></li>
<li class="chapter" data-level="1.5.4" data-path="intro.html"><a href="intro.html#subsec-hotel-price"><i class="fa fa-check"></i><b>1.5.4</b> Стоимость номеров в трех гостиницах</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>I Разведочный анализ данных</b></span></li>
<li class="chapter" data-level="2" data-path="ch-missing-values.html"><a href="ch-missing-values.html"><i class="fa fa-check"></i><b>2</b> Обработка пропущенных наблюдений</a></li>
<li class="chapter" data-level="3" data-path="ch-aggregation.html"><a href="ch-aggregation.html"><i class="fa fa-check"></i><b>3</b> Агрегирование наблюдений</a></li>
<li class="chapter" data-level="4" data-path="ch-visualisation.html"><a href="ch-visualisation.html"><i class="fa fa-check"></i><b>4</b> Визуализация временных рядов и их свойств</a></li>
<li class="chapter" data-level="5" data-path="ch-feature-extraction.html"><a href="ch-feature-extraction.html"><i class="fa fa-check"></i><b>5</b> Извлечение признаков с помощью пакета <code>feasts</code></a><ul>
<li class="chapter" data-level="5.1" data-path="ch-feature-extraction.html"><a href="ch-feature-extraction.html#sec-features-function"><i class="fa fa-check"></i><b>5.1</b> Функция <code>features()</code></a></li>
<li class="chapter" data-level="5.2" data-path="ch-feature-extraction.html"><a href="ch-feature-extraction.html#sec-feasts-embedded-features"><i class="fa fa-check"></i><b>5.2</b> Встроенные функции для расчета признаков</a><ul>
<li class="chapter" data-level="" data-path="ch-feature-extraction.html"><a href="ch-feature-extraction.html#acf"><i class="fa fa-check"></i>acf</a></li>
<li class="chapter" data-level="" data-path="ch-feature-extraction.html"><a href="ch-feature-extraction.html#autocorrelation"><i class="fa fa-check"></i>autocorrelation</a></li>
<li class="chapter" data-level="" data-path="ch-feature-extraction.html"><a href="ch-feature-extraction.html#boxcox"><i class="fa fa-check"></i>boxcox</a></li>
<li class="chapter" data-level="" data-path="ch-feature-extraction.html"><a href="ch-feature-extraction.html#coefficients"><i class="fa fa-check"></i>coefficients</a></li>
<li class="chapter" data-level="" data-path="ch-feature-extraction.html"><a href="ch-feature-extraction.html#count"><i class="fa fa-check"></i>count</a></li>
<li class="chapter" data-level="" data-path="ch-feature-extraction.html"><a href="ch-feature-extraction.html#decomposition"><i class="fa fa-check"></i>decomposition</a></li>
<li class="chapter" data-level="" data-path="ch-feature-extraction.html"><a href="ch-feature-extraction.html#intermittent"><i class="fa fa-check"></i>intermittent</a></li>
<li class="chapter" data-level="" data-path="ch-feature-extraction.html"><a href="ch-feature-extraction.html#lumpiness"><i class="fa fa-check"></i>lumpiness</a></li>
<li class="chapter" data-level="" data-path="ch-feature-extraction.html"><a href="ch-feature-extraction.html#optimisation"><i class="fa fa-check"></i>optimisation</a></li>
<li class="chapter" data-level="" data-path="ch-feature-extraction.html"><a href="ch-feature-extraction.html#pacf"><i class="fa fa-check"></i>pacf</a></li>
<li class="chapter" data-level="" data-path="ch-feature-extraction.html"><a href="ch-feature-extraction.html#portmanteau"><i class="fa fa-check"></i>portmanteau</a></li>
<li class="chapter" data-level="" data-path="ch-feature-extraction.html"><a href="ch-feature-extraction.html#rle"><i class="fa fa-check"></i>rle</a></li>
<li class="chapter" data-level="" data-path="ch-feature-extraction.html"><a href="ch-feature-extraction.html#roll"><i class="fa fa-check"></i>roll</a></li>
<li class="chapter" data-level="" data-path="ch-feature-extraction.html"><a href="ch-feature-extraction.html#seasonal"><i class="fa fa-check"></i>seasonal</a></li>
<li class="chapter" data-level="" data-path="ch-feature-extraction.html"><a href="ch-feature-extraction.html#slide"><i class="fa fa-check"></i>slide</a></li>
<li class="chapter" data-level="" data-path="ch-feature-extraction.html"><a href="ch-feature-extraction.html#spectral"><i class="fa fa-check"></i>spectral</a></li>
<li class="chapter" data-level="" data-path="ch-feature-extraction.html"><a href="ch-feature-extraction.html#stability"><i class="fa fa-check"></i>stability</a></li>
<li class="chapter" data-level="" data-path="ch-feature-extraction.html"><a href="ch-feature-extraction.html#stl"><i class="fa fa-check"></i>stl</a></li>
<li class="chapter" data-level="" data-path="ch-feature-extraction.html"><a href="ch-feature-extraction.html#test"><i class="fa fa-check"></i>test</a></li>
<li class="chapter" data-level="" data-path="ch-feature-extraction.html"><a href="ch-feature-extraction.html#tile"><i class="fa fa-check"></i>tile</a></li>
<li class="chapter" data-level="" data-path="ch-feature-extraction.html"><a href="ch-feature-extraction.html#trend"><i class="fa fa-check"></i>trend</a></li>
<li class="chapter" data-level="" data-path="ch-feature-extraction.html"><a href="ch-feature-extraction.html#unitroot"><i class="fa fa-check"></i>unitroot</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="ch-feature-extraction.html"><a href="ch-feature-extraction.html#sec-features-use"><i class="fa fa-check"></i><b>5.3</b> Примеры использования извлеченных признаков</a></li>
</ul></li>
<li class="part"><span><b>II Прогнозирование временных рядов</b></span></li>
<li class="chapter" data-level="6" data-path="ch-intro-to-prophet.html"><a href="ch-intro-to-prophet.html"><i class="fa fa-check"></i><b>6</b> Пакет <code>prophet</code></a><ul>
<li class="chapter" data-level="6.1" data-path="ch-intro-to-prophet.html"><a href="ch-intro-to-prophet.html#sec-how-prophet-works"><i class="fa fa-check"></i><b>6.1</b> Методология</a></li>
<li class="chapter" data-level="6.2" data-path="ch-intro-to-prophet.html"><a href="ch-intro-to-prophet.html#sec-first-prophet-example"><i class="fa fa-check"></i><b>6.2</b> Первый простой пример</a></li>
<li class="chapter" data-level="6.3" data-path="ch-intro-to-prophet.html"><a href="ch-intro-to-prophet.html#sec-prophet-params"><i class="fa fa-check"></i><b>6.3</b> Функция <code>prophet()</code></a></li>
<li class="chapter" data-level="6.4" data-path="ch-intro-to-prophet.html"><a href="ch-intro-to-prophet.html#sec-prophet-changepoints"><i class="fa fa-check"></i><b>6.4</b> Точки излома тренда</a></li>
<li class="chapter" data-level="6.5" data-path="ch-intro-to-prophet.html"><a href="ch-intro-to-prophet.html#sec-prophet-holidays"><i class="fa fa-check"></i><b>6.5</b> Эффекты праздников и других важных событий</a><ul>
<li class="chapter" data-level="6.5.1" data-path="ch-intro-to-prophet.html"><a href="ch-intro-to-prophet.html#формат-представления"><i class="fa fa-check"></i><b>6.5.1</b> Формат представления</a></li>
<li class="chapter" data-level="6.5.2" data-path="ch-intro-to-prophet.html"><a href="ch-intro-to-prophet.html#встроенные-даты-праздников"><i class="fa fa-check"></i><b>6.5.2</b> Встроенные даты праздников</a></li>
<li class="chapter" data-level="6.5.3" data-path="ch-intro-to-prophet.html"><a href="ch-intro-to-prophet.html#регуляризация"><i class="fa fa-check"></i><b>6.5.3</b> Регуляризация</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="ch-intro-to-prophet.html"><a href="ch-intro-to-prophet.html#sec-prophet-seasonal-components"><i class="fa fa-check"></i><b>6.6</b> Сезонные компоненты</a><ul>
<li class="chapter" data-level="6.6.1" data-path="ch-intro-to-prophet.html"><a href="ch-intro-to-prophet.html#годовая-недельная-и-дневная-компоненты"><i class="fa fa-check"></i><b>6.6.1</b> Годовая, недельная и дневная компоненты</a></li>
<li class="chapter" data-level="6.6.2" data-path="ch-intro-to-prophet.html"><a href="ch-intro-to-prophet.html#пользовательские-сезонные-компоненты"><i class="fa fa-check"></i><b>6.6.2</b> Пользовательские сезонные компоненты</a></li>
<li class="chapter" data-level="6.6.3" data-path="ch-intro-to-prophet.html"><a href="ch-intro-to-prophet.html#условные-режимы-сезонности"><i class="fa fa-check"></i><b>6.6.3</b> Условные режимы сезонности</a></li>
<li class="chapter" data-level="6.6.4" data-path="ch-intro-to-prophet.html"><a href="ch-intro-to-prophet.html#регуляризация-сезонных-компонент"><i class="fa fa-check"></i><b>6.6.4</b> Регуляризация сезонных компонент</a></li>
<li class="chapter" data-level="6.6.5" data-path="ch-intro-to-prophet.html"><a href="ch-intro-to-prophet.html#аддитивная-и-мультипликативная-сезонности"><i class="fa fa-check"></i><b>6.6.5</b> Аддитивная и мультипликативная сезонности</a></li>
</ul></li>
<li class="chapter" data-level="6.7" data-path="ch-intro-to-prophet.html"><a href="ch-intro-to-prophet.html#sec-prophet-predictors"><i class="fa fa-check"></i><b>6.7</b> Модели с предикторами</a></li>
<li class="chapter" data-level="6.8" data-path="ch-intro-to-prophet.html"><a href="ch-intro-to-prophet.html#sec-prophet-optimal-model"><i class="fa fa-check"></i><b>6.8</b> Выбор оптимальной модели</a><ul>
<li class="chapter" data-level="6.8.1" data-path="ch-intro-to-prophet.html"><a href="ch-intro-to-prophet.html#subsec-shf"><i class="fa fa-check"></i><b>6.8.1</b> Метод имитированных исторических прогнозов</a></li>
<li class="chapter" data-level="6.8.2" data-path="ch-intro-to-prophet.html"><a href="ch-intro-to-prophet.html#выполнение-перекрестной-проверки"><i class="fa fa-check"></i><b>6.8.2</b> Выполнение перекрестной проверки</a></li>
<li class="chapter" data-level="6.8.3" data-path="ch-intro-to-prophet.html"><a href="ch-intro-to-prophet.html#subsec-perf-metric"><i class="fa fa-check"></i><b>6.8.3</b> Метрики качества модели</a></li>
<li class="chapter" data-level="6.8.4" data-path="ch-intro-to-prophet.html"><a href="ch-intro-to-prophet.html#пример-выбора-оптимальной-модели"><i class="fa fa-check"></i><b>6.8.4</b> Пример выбора оптимальной модели</a></li>
</ul></li>
<li class="chapter" data-level="6.9" data-path="ch-intro-to-prophet.html"><a href="ch-intro-to-prophet.html#sec-system-capacity"><i class="fa fa-check"></i><b>6.9</b> Моделирование емкости системы</a><ul>
<li class="chapter" data-level="6.9.1" data-path="ch-intro-to-prophet.html"><a href="ch-intro-to-prophet.html#тренд-с-насыщением"><i class="fa fa-check"></i><b>6.9.1</b> Тренд с насыщением</a></li>
<li class="chapter" data-level="6.9.2" data-path="ch-intro-to-prophet.html"><a href="ch-intro-to-prophet.html#примеры-моделей-с-насыщением-тренда"><i class="fa fa-check"></i><b>6.9.2</b> Примеры моделей с насыщением тренда</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="ch-intro-to-bsts.html"><a href="ch-intro-to-bsts.html"><i class="fa fa-check"></i><b>7</b> Пакет <code>bsts</code></a><ul>
<li class="chapter" data-level="7.1" data-path="ch-intro-to-bsts.html"><a href="ch-intro-to-bsts.html#sec-how-bsts-works"><i class="fa fa-check"></i><b>7.1</b> Методология</a></li>
<li class="chapter" data-level="7.2" data-path="ch-intro-to-bsts.html"><a href="ch-intro-to-bsts.html#sec-bsts-function"><i class="fa fa-check"></i><b>7.2</b> Функция <code>bsts()</code></a></li>
<li class="chapter" data-level="7.3" data-path="ch-intro-to-bsts.html"><a href="ch-intro-to-bsts.html#sec-bsts-add-functions"><i class="fa fa-check"></i><b>7.3</b> Спецификация компонент модели</a></li>
<li class="chapter" data-level="7.4" data-path="ch-intro-to-bsts.html"><a href="ch-intro-to-bsts.html#sec-bsts-model-examples"><i class="fa fa-check"></i><b>7.4</b> Примеры моделей без предикторов</a></li>
<li class="chapter" data-level="7.5" data-path="ch-intro-to-bsts.html"><a href="ch-intro-to-bsts.html#sec-bsts-models-with-regressors"><i class="fa fa-check"></i><b>7.5</b> Модели с предикторами</a></li>
<li class="chapter" data-level="7.6" data-path="ch-intro-to-bsts.html"><a href="ch-intro-to-bsts.html#sec-bsts-optimal-model"><i class="fa fa-check"></i><b>7.6</b> Выбор оптимальной модели</a></li>
</ul></li>
<li class="part"><span><b>III Структурные изменения и аномалии во временных рядах</b></span></li>
<li class="chapter" data-level="8" data-path="ch-structural-changes.html"><a href="ch-structural-changes.html"><i class="fa fa-check"></i><b>8</b> Выявление структурных изменений</a><ul>
<li class="chapter" data-level="8.1" data-path="ch-structural-changes.html"><a href="ch-structural-changes.html#метод-edivisive-with-medians-edm"><i class="fa fa-check"></i><b>8.1</b> Метод “E–Divisive with Medians” (EDM)</a></li>
<li class="chapter" data-level="8.2" data-path="ch-structural-changes.html"><a href="ch-structural-changes.html#функция-breakout"><i class="fa fa-check"></i><b>8.2</b> Функция <code>breakout()</code></a></li>
<li class="chapter" data-level="8.3" data-path="ch-structural-changes.html"><a href="ch-structural-changes.html#примеры-использования-функции-breakout"><i class="fa fa-check"></i><b>8.3</b> Примеры использования функции <code>breakout()</code></a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="ch-anomaly-detection.html"><a href="ch-anomaly-detection.html"><i class="fa fa-check"></i><b>9</b> Выявление аномалий</a><ul>
<li class="chapter" data-level="9.1" data-path="ch-anomaly-detection.html"><a href="ch-anomaly-detection.html#автоматическое-обнаружение-аномалий"><i class="fa fa-check"></i><b>9.1</b> Автоматическое обнаружение аномалий</a></li>
<li class="chapter" data-level="9.2" data-path="ch-anomaly-detection.html"><a href="ch-anomaly-detection.html#ручная-настройка-параметров-для-обнаружения-аномалий"><i class="fa fa-check"></i><b>9.2</b> Ручная настройка параметров для обнаружения аномалий</a></li>
<li class="chapter" data-level="9.3" data-path="ch-anomaly-detection.html"><a href="ch-anomaly-detection.html#одновременный-анализ-нескольких-временных-рядов"><i class="fa fa-check"></i><b>9.3</b> Одновременный анализ нескольких временных рядов</a></li>
</ul></li>
<li class="part"><span><b>IV Кластеризация</b></span></li>
<li class="chapter" data-level="10" data-path="ch-ts-clustering-task.html"><a href="ch-ts-clustering-task.html"><i class="fa fa-check"></i><b>10</b> Задача кластеризации временных рядов</a></li>
<li class="chapter" data-level="11" data-path="ch-ts-clustering-by-raw-data.html"><a href="ch-ts-clustering-by-raw-data.html"><i class="fa fa-check"></i><b>11</b> Кластеризация по исходным данным</a><ul>
<li class="chapter" data-level="11.1" data-path="ch-ts-clustering-by-raw-data.html"><a href="ch-ts-clustering-by-raw-data.html#dtw-расстояние"><i class="fa fa-check"></i><b>11.1</b> DTW-расстояние</a></li>
<li class="chapter" data-level="11.2" data-path="ch-ts-clustering-by-raw-data.html"><a href="ch-ts-clustering-by-raw-data.html#пакет-dtwclust"><i class="fa fa-check"></i><b>11.2</b> Пакет <code>dtwclust</code></a></li>
<li class="chapter" data-level="11.3" data-path="ch-ts-clustering-by-raw-data.html"><a href="ch-ts-clustering-by-raw-data.html#пример-кластеризации-с-использованием-dtwрасстояния"><i class="fa fa-check"></i><b>11.3</b> Пример кластеризации с использованием DTW–расстояния</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="ch-features-based-clustering.html"><a href="ch-features-based-clustering.html"><i class="fa fa-check"></i><b>12</b> Кластеризация по описательным признакам</a></li>
<li class="chapter" data-level="13" data-path="ch-model-based-clustering.html"><a href="ch-model-based-clustering.html"><i class="fa fa-check"></i><b>13</b> Кластеризация по результатам подгонки моделей</a></li>
<li class="chapter" data-level="14" data-path="ch-literature.html"><a href="ch-literature.html"><i class="fa fa-check"></i><b>14</b> Литература</a></li>
<li class="divider"></li>
<li><a href="http://mastitsky.com">
© 2020, Мастицкий С. Э.</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Анализ временных рядов с помощью R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="ch-structural-changes" class="section level1">
<h1><span class="header-section-number">ГЛАВА 8</span> Выявление структурных изменений</h1>
<p>Практически любая промышленная система сегодня снабжена совокупностью сенсоров, датчиков и других измерительных устройств, позволяющих вести учет ее состояния (часто в реальном времени). Количество таких измерительных устройств и учитываемых с их помощью показателей может быть очень большим, что требует автоматизации процесса мониторинга и своевременного оповещения о нестандартных (например, предаварийных и аварийных) ситуациях. Подобные нестандартные ситуации обычно сопряжены с существенными изменениям во временных рядах, описывающих те или иные показатели. Одним из типов таких изменений является сдвиг среднего уровня временного ряда, который может быть как очень резким, так и постепенным (рис. <a href="ch-structural-changes.html#fig:struct-change-types">8.1</a>). Существует несколько методов, позволяющих автоматически обнаруживать подобные структурные изменения во временных рядах. Одним из них является метод “E–Divisive with Medians” (EDM), разработанный исследователями из Корнеллского университета и компании Twitter <span class="citation">(James, Kejariwal, and Matteson <a href="ch-literature.html#ref-james_et_al_2016" role="doc-biblioref">2015</a>)</span> и реализованный в пакете для R <code>BreakoutDetection</code>. В этой главе приведено краткое описание основ работы с данным пакетом.</p>

<div class="figure" style="text-align: center"><span id="fig:struct-change-types"></span>
<img src="time_series_ru_files/figure-html/struct-change-types-1.png" alt="Примеры структурных изменений во временных рядах: резкое (вверху) и плавное (внизу)" width="100%" />
<p class="caption">
РИСУНОК 8.1: Примеры структурных изменений во временных рядах: резкое (вверху) и плавное (внизу)
</p>
</div>
<p>Пакет <code>BreakoutDetection</code> можно установить только из репозитория GitHub, для чего достаточно воспользоваться функцией <code>install_github()</code> из пакета <code>devtools</code> (который, конечно, тоже нужно сначала установить, если у вас его еще нет):</p>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb161-1" title="1"><span class="kw">install.packages</span>(<span class="st">&quot;devtools&quot;</span>)</a>
<a class="sourceLine" id="cb161-2" title="2">devtools<span class="op">::</span><span class="kw">install_github</span>(<span class="st">&quot;twitter/BreakoutDetection&quot;</span>)</a></code></pre></div>
<div id="метод-edivisive-with-medians-edm" class="section level2">
<h2><span class="header-section-number">8.1</span> Метод “E–Divisive with Medians” (EDM)</h2>
<p>Подробное описание теории, лежащей в основе EDM, приведено в статье <span class="citation">James, Kejariwal, and Matteson (<a href="ch-literature.html#ref-james_et_al_2016" role="doc-biblioref">2015</a>)</span>. Вкратце, этот метод основан на использовании т.н. <span class="math inline">\(E\)</span>–статистики (от “energy”, т.е. “энергия”), которая характиризует расстояние между наблюдениями из случайных выборок. Чем больше эта статистика, тем больше оснований считать, что сравниваемые выборки происходят из разных генеральных совокупностей. Во избежание влияния обычных на практике аномальных наблюдений, метод EDM оперирует не средними значениями, а медианами. Более того, это непараметрический метод, т.е. он не исходит из предположения о принадлежности анализируемых наблюдений к каким–либо конкретным распределениям вероятностей. Непараметрическая природа EDM, а также использование медианы в качестве меры центральной тенденции, делают этот метод особенно подходящим для обнаружения структурных изменений во временных рядах при решении практических задач.</p>
</div>
<div id="функция-breakout" class="section level2">
<h2><span class="header-section-number">8.2</span> Функция <code>breakout()</code></h2>
<p>В пакете <code>BreakoutDetection</code> есть всего лишь одна функция — <code>breakout()</code>, которая имеет следующие аргументы:</p>
<ul>
<li><code>Z</code> — временной ряд, который может быть представлен либо в виде числового вектора, либо в виде таблицы данных со столбцами <code>timestamp</code> (“временная отметка”) и <code>count</code> (“количество”).</li>
<li><code>min.size</code> — минимальное количество наблюдений, которое должно иметь место между точками излома тренда во временном ряду (по умолчанию равно 30).</li>
<li><code>method</code> — название применяемого к данным сценария по обнаружению структурных изменений. Принимает два возможных значения: <code>"amoc"</code> (от “at most one change”, т.е. “не более одного изменения”) и <code>"multi"</code> (несколько точек излома).</li>
<li><code>...</code> — дополнительные аргументы.</li>
</ul>
<p>Набор дополнительных аргументов (<code>...</code>) зависит от значения параметра <code>method</code>. В обоих случаях (т.е. и <code>"amoc"</code>, и <code>"multi"</code>) функция примет следующие аргументы:</p>
<ul>
<li><code>plot</code> — логический значение, включающее (<code>TRUE</code>) или отключающее (<code>FALSE</code>) построение графика временного ряда с отметками позиций обнаруженных точек излома тренда;</li>
<li><code>xlab</code> и <code>ylab</code> — подписи осей графика;</li>
<li><code>title</code> — заголовок графика.</li>
</ul>
<p>Если <code>method = "amoc"</code>, то функция <code>breakout()</code> примет также:</p>
<ul>
<li><code>alpha</code> — параметр, используемый в EDM для придания разных весов расстояниям между наблюдениями. Принимает любое значение из интервала (0, 2] (по умолчанию <code>alpha = 2</code>).</li>
<li><code>exact</code> — логический аргумент. По умолчанию равен <code>TRUE</code>, что приводит к расчету точных значений медиан при нахождении точек излома (в случае с длинными рядами это может сопровождаться длительными вычислениями).</li>
<li><code>sig.lvl</code> — желаемый уровень статистической значимости теста для обнаруженной точки излома тренда (по умолчанию равен 0.05).</li>
<li><code>nperm</code> — количество итераций при выполнении <a href="https://www.coursera.org/lecture/stats-for-data-analysis/pieriestanovochnyie-kritierii-Dd0Fl">перестановочного теста</a>. По умолчанию <code>nperm = 0,</code> т.е. перестановочный тест не выполняется.</li>
</ul>
<p>Когда требуется обнаружить несколько точек излома тренда (<code>method = "multi"</code>), на функцию <code>breakout()</code> можно подать также следующие аргументы, задающие уровень регуляризации в отношении количества и близости взаимного расположения этих точек:</p>
<ul>
<li><code>degree</code> — параметр, определяющий близость расположения точек излома. Принимает значения 0, 1 (принято по умолчанию) и 2. Чем больше этот параметр, тем меньше точек излома располагаются близко друг к другу.</li>
<li><code>percent</code> — задает минимальное относительное (%) увеличение внутреннего <em>критерия качества EDM</em> (здесь не рассматривается), необходимое для классификации того или иного наблюдения как точки излома тренда. Например, значение 0.25 соответствует 25%–ному увеличению критерия. Аргумент <code>percent</code> не имеет значения, принятого по умолчанию.</li>
<li><code>beta</code> — принимает любое числовое значение (по умолчанию равен 0.008) и используется для регуляризации если <code>degree</code> и/или <code>percent</code> не заданы. Чем больше этот параметр, тем меньше точек излома будет обнаружено алгоритмом.</li>
</ul>
</div>
<div id="примеры-использования-функции-breakout" class="section level2">
<h2><span class="header-section-number">8.3</span> Примеры использования функции <code>breakout()</code></h2>
<p>Применим функцию <code>breakout()</code> с ее принятыми по умолчанию параметрами к данным по стоимости биткоина (подразд. <a href="intro.html#subsec-bitcoin-price">1.5.2</a>):</p>

<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb162-1" title="1"><span class="kw">require</span>(BreakoutDetection)</a>
<a class="sourceLine" id="cb162-2" title="2"></a>
<a class="sourceLine" id="cb162-3" title="3">BO0 &lt;-<span class="st"> </span><span class="kw">breakout</span>(<span class="kw">log</span>(bitcoin<span class="op">$</span>y), <span class="dt">plot =</span> <span class="ot">TRUE</span>, <span class="dt">ylab =</span> <span class="st">&quot;y&quot;</span>)</a>
<a class="sourceLine" id="cb162-4" title="4">BO0<span class="op">$</span>plot</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:breakout-bitcoin"></span>
<img src="time_series_ru_files/figure-html/breakout-bitcoin-1.png" alt="Точка излома тренда, обнаруженная во временном ряду стоимости биткоина с помощью модели BO0" width="100%" />
<p class="caption">
РИСУНОК 8.2: Точка излома тренда, обнаруженная во временном ряду стоимости биткоина с помощью модели <code>BO0</code>
</p>
</div>
<p>Как видно на рис. <a href="ch-structural-changes.html#fig:breakout-bitcoin">8.2</a>, метод EDM обнаружил одну единственную точку излома тренда (отмечена вертикальной прерывистой линией), что обусловлено принятым по умолчанию аргументом <code>method = "amoc"</code> (см. выше). Для оценивания статистической значимости этого сдвига во временном ряду следует воспользоваться аргументом <code>nperm</code>. Выполним такое оценивание с помощью перестановочного теста с 1000 итераций (выполнение этой команды займет какое–то время):</p>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb163-1" title="1">BO0_perm &lt;-<span class="st"> </span><span class="kw">breakout</span>(<span class="kw">log</span>(bitcoin<span class="op">$</span>y), <span class="dt">nperm =</span> <span class="dv">1000</span>)</a></code></pre></div>
<p>Объект <code>BO0_perm</code> представляет собой список со следующими элементами:</p>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb164-1" title="1">BO0_perm</a></code></pre></div>
<pre><code>## $loc
## [1] 561
## 
## $stat
## [1] 107.6948
## 
## $time
## [1] 44.78
## 
## $pval
## [1] 0.000999001</code></pre>
<p>где <code>loc</code> — это положение точки излома (т.е. ее порядковый номер во временном ряду), <code>stat</code> — значение E-критерия, <code>time</code> — время выполнения команды (сек.), а <code>pval</code> — <span class="math inline">\(p\)</span>–значение, полученное с помощью перестановочного теста. Как видим, обнаруженный сдвиг уровня временного ряда оказался статистически значимым (на уровне значимости 0.05).</p>
<p>Запросим теперь нахождение нескольких точек излома (рис. <a href="ch-structural-changes.html#fig:breakout-bitcoin-multi">8.3</a>):</p>

<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb166-1" title="1">BO1 &lt;-<span class="st"> </span><span class="kw">breakout</span>(<span class="kw">log</span>(bitcoin<span class="op">$</span>y), <span class="dt">method =</span> <span class="st">&quot;multi&quot;</span>, </a>
<a class="sourceLine" id="cb166-2" title="2">                <span class="dt">plot =</span> <span class="ot">TRUE</span>, <span class="dt">ylab =</span> <span class="st">&quot;y&quot;</span>)</a>
<a class="sourceLine" id="cb166-3" title="3">BO1<span class="op">$</span>plot</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:breakout-bitcoin-multi"></span>
<img src="time_series_ru_files/figure-html/breakout-bitcoin-multi-1.png" alt="Точки излома тренда, обнаруженные во временном ряду стоимости биткоина с помощью модели BO1" width="100%" />
<p class="caption">
РИСУНОК 8.3: Точки излома тренда, обнаруженные во временном ряду стоимости биткоина с помощью модели <code>BO1</code>
</p>
</div>
<p>Рассмотрим теперь влияние параметров регуляризации. Сначала отключим регуляризацию с помощью параметра <code>degree = 0</code> (рис. <a href="ch-structural-changes.html#fig:breakout-bitcoin-multi-zero-degree">8.4</a>):</p>

<div class="sourceCode" id="cb167"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb167-1" title="1">BO2 &lt;-<span class="st"> </span><span class="kw">breakout</span>(<span class="kw">log</span>(bitcoin<span class="op">$</span>y), <span class="dt">method =</span> <span class="st">&quot;multi&quot;</span>, <span class="dt">degree =</span> <span class="dv">0</span>, </a>
<a class="sourceLine" id="cb167-2" title="2">                <span class="dt">plot =</span> <span class="ot">TRUE</span>, <span class="dt">ylab =</span> <span class="st">&quot;y&quot;</span>)</a>
<a class="sourceLine" id="cb167-3" title="3">BO2<span class="op">$</span>plot</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:breakout-bitcoin-multi-zero-degree"></span>
<img src="time_series_ru_files/figure-html/breakout-bitcoin-multi-zero-degree-1.png" alt="Точки излома тренда, обнаруженные во временном ряду стоимости биткоина с помощью модели BO2" width="100%" />
<p class="caption">
РИСУНОК 8.4: Точки излома тренда, обнаруженные во временном ряду стоимости биткоина с помощью модели <code>BO2</code>
</p>
</div>
<p>Как было отмечено выше, порядковые номера наблюдений, соответствующих обнаруженным точкам излома, хранятся в элементе <code>loc</code> получаемого объекта–списка:</p>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb168-1" title="1">BO2<span class="op">$</span>loc</a></code></pre></div>
<pre><code>##  [1]   43   74  113  158  203  246  302  484  680  755  840  879  927  957  992
## [16] 1048 1144 1201</code></pre>
<p>Похожего эффекта (увеличение количества обнаруженных точек излома) можно добиться также с помощью низкого значения параметра <code>percent</code> (рис. <a href="ch-structural-changes.html#fig:breakout-bitcoin-percent">8.5</a>):</p>

<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb170-1" title="1">BO3 &lt;-<span class="st"> </span><span class="kw">breakout</span>(<span class="kw">log</span>(bitcoin<span class="op">$</span>y), <span class="dt">method =</span> <span class="st">&quot;multi&quot;</span>, <span class="dt">percent =</span> <span class="fl">0.05</span>, </a>
<a class="sourceLine" id="cb170-2" title="2">                <span class="dt">plot =</span> <span class="ot">TRUE</span>, <span class="dt">ylab =</span> <span class="st">&quot;y&quot;</span>)</a>
<a class="sourceLine" id="cb170-3" title="3">BO3<span class="op">$</span>plot</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:breakout-bitcoin-percent"></span>
<img src="time_series_ru_files/figure-html/breakout-bitcoin-percent-1.png" alt="Точки излома тренда, обнаруженные во временном ряду стоимости биткоина с помощью модели BO3" width="100%" />
<p class="caption">
РИСУНОК 8.5: Точки излома тренда, обнаруженные во временном ряду стоимости биткоина с помощью модели <code>BO3</code>
</p>
</div>
<p>Наконец, снижение параметра <code>beta</code> тоже приведет к увеличению числа обнаруженных алгоритмом точек излома (рис. 7):</p>

<div class="sourceCode" id="cb171"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb171-1" title="1">BO4 &lt;-<span class="st"> </span><span class="kw">breakout</span>(<span class="kw">log</span>(bitcoin<span class="op">$</span>y), <span class="dt">method =</span> <span class="st">&quot;multi&quot;</span>, <span class="dt">beta =</span> <span class="fl">0.0001</span>, </a>
<a class="sourceLine" id="cb171-2" title="2">                <span class="dt">plot =</span> <span class="ot">TRUE</span>, <span class="dt">ylab =</span> <span class="st">&quot;y&quot;</span>)</a>
<a class="sourceLine" id="cb171-3" title="3">BO4<span class="op">$</span>plot</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:breakout-bitcoin-beta"></span>
<img src="time_series_ru_files/figure-html/breakout-bitcoin-beta-1.png" alt="Точки излома тренда, обнаруженные во временном ряду стоимости биткоина с помощью модели BO4" width="100%" />
<p class="caption">
РИСУНОК 8.6: Точки излома тренда, обнаруженные во временном ряду стоимости биткоина с помощью модели <code>BO4</code>
</p>
</div>
<p>Итак, мы рассмотрели принципы работы с пакетом <code>BreakoutDetection</code>, в котором реализован один из наиболее эффективных методов обнаружения структурных изменений во временных рядах — “E-Divisive with Medians”. Как было отмечено выше, этот метод особенно хорошо подходит для использования в автоматических системах мониторинга параметров технических систем (именно для этого он изначально был разработан в компании Twitter). Другие примеры, где EDM может оказаться полезным, включают:</p>
<ul>
<li>анализ результатов, полученных в ходе A/B тестирования (аргумент <code>method</code> со значением <code>"amoc"</code> позволит оценить влияние экспериментального фактора на сдвиг интересующей исследователя переменной–отклика);</li>
<li>обнаружение изменений в переменных, описывающих поведение людей (например, активность в социальных сетях) или животных и т.п.</li>
</ul>
<p>Хотя пакет <code>BreakoutDetection</code> очень прост в использовании и дает надежные результаты, следует отметить, что он, к сожалению, не обновлялся с 2014 г. Об этом стоит помнить, если вы решите использовать его в своих проектах.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="ch-intro-to-bsts.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="ch-anomaly-detection.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": true,
"twitter": true,
"linkedin": true,
"weibo": false,
"instapaper": false,
"vk": true,
"all": false
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["time_series_ru.epub"],
"toc": {
"collapse": "subsection"
},
"search": false,
"info": false
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
